<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOMç›‘å¬å™¨è°ƒè¯•æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }

        .test-area {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .target-element {
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #2196F3;
            border-radius: 4px;
            background-color: #e3f2fd;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .target-element:hover {
            background-color: #bbdefb;
            transform: scale(1.02);
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-primary { background-color: #2196F3; color: white; }
        .btn-success { background-color: #4CAF50; color: white; }
        .btn-warning { background-color: #FF9800; color: white; }

        .debug-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }

        .status.success { background-color: #d4edda; color: #155724; }
        .status.error { background-color: #f8d7da; color: #721c24; }
        .status.info { background-color: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>ğŸ” DOMç›‘å¬å™¨è°ƒè¯•æµ‹è¯•é¡µé¢</h1>

    <div class="test-area">
        <h2>ğŸ§ª è°ƒè¯•ä¿¡æ¯</h2>
        <div id="debugInfo" class="debug-info">
            <div>æ£€æŸ¥æ‰©å±•çŠ¶æ€...</div>
        </div>
        <div id="status" class="status info">
            ç­‰å¾…æµ‹è¯•...
        </div>
        <button onclick="checkExtension()" class="btn-primary">æ£€æŸ¥æ‰©å±•çŠ¶æ€</button>
        <button onclick="testContentScript()" class="btn-success">æµ‹è¯•å†…å®¹è„šæœ¬</button>
        <button onclick="testManually()" class="btn-warning">æ‰‹åŠ¨æµ‹è¯•</button>
    </div>

    <div class="test-area">
        <h2>ğŸ¯ æµ‹è¯•å…ƒç´ </h2>
        <div id="testElement1" class="target-element" data-test="initial" data-counter="0">
            <strong>æµ‹è¯•å…ƒç´  1</strong>
            <br>data-test: <span id="testValue1">initial</span>
            <br>data-counter: <span id="counterValue1">0</span>
        </div>

        <div>
            <button onclick="changeTestElement()">æ”¹å˜å±æ€§</button>
            <button onclick="incrementCounter()">å¢åŠ è®¡æ•°å™¨</button>
            <button onclick="resetTestElement()">é‡ç½®å…ƒç´ </button>
        </div>
    </div>

    <div class="test-area">
        <h2>ğŸ“‹ æµ‹è¯•è¯´æ˜</h2>
        <ol>
            <li>é¦–å…ˆç‚¹å‡»"æ£€æŸ¥æ‰©å±•çŠ¶æ€"ç¡®è®¤æ‰©å±•å·²åŠ è½½</li>
            <li>ç‚¹å‡»"æµ‹è¯•å†…å®¹è„šæœ¬"éªŒè¯åŸºæœ¬åŠŸèƒ½</li>
            <li>æ‰“å¼€æ‰©å±•popupï¼ˆç‚¹å‡»æµè§ˆå™¨å·¥å…·æ ä¸­çš„æ‰©å±•å›¾æ ‡ï¼‰</li>
            <li>åœ¨popupä¸­ç‚¹å‡»"ğŸ¯ é€‰æ‹©å…ƒç´ "æŒ‰é’®</li>
            <li>ç‚¹å‡»é¡µé¢ä¸Šçš„è“è‰²æµ‹è¯•å…ƒç´ </li>
            <li>é€‰æ‹©è¦ç›‘å¬çš„å±æ€§ï¼ˆå¦‚data-testï¼‰</li>
            <li>ç‚¹å‡»"â–¶ï¸ å¼€å§‹ç›‘å¬"</li>
            <li>ç‚¹å‡»"æ”¹å˜å±æ€§"æŒ‰é’®æµ‹è¯•ç›‘å¬åŠŸèƒ½</li>
        </ol>
    </div>

    <script>
        let counter = 0;

        function updateDebugInfo(message, type = 'info') {
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            debugInfo.scrollTop = debugInfo.scrollHeight;
        }

        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${type}`;
        }

        function checkExtension() {
            updateDebugInfo('å¼€å§‹æ£€æŸ¥æ‰©å±•çŠ¶æ€...');
            updateStatus('è¯·é€šè¿‡æ‰©å±•popupè¿›è¡Œæµ‹è¯•', 'info');

            // æ³¨æ„ï¼šåœ¨æ™®é€šé¡µé¢ä¸­Chromeæ‰©å±•APIä¸å¯ç”¨æ˜¯æ­£å¸¸çš„
            updateDebugInfo('â„¹ï¸ åœ¨æ™®é€šé¡µé¢ä¸­Chromeæ‰©å±•APIä¸å¯ç”¨æ˜¯æ­£å¸¸çš„');
            updateDebugInfo('â„¹ï¸ è¯·é€šè¿‡æµè§ˆå™¨æ‰©å±•å›¾æ ‡è¿›è¡Œæµ‹è¯•');
            updateDebugInfo('â„¹ï¸ æ‰©å±•APIåªåœ¨å†…å®¹è„šæœ¬å’Œæ‰©å±•åå°é¡µé¢ä¸­å¯ç”¨');

            // æ£€æŸ¥é¡µé¢æ˜¯å¦å¯ä»¥æ­£å¸¸æ“ä½œ
            if (document.getElementById('testElement1')) {
                updateDebugInfo('âœ… æµ‹è¯•å…ƒç´ å­˜åœ¨');
                updateStatus('é¡µé¢å…ƒç´ æ­£å¸¸ï¼Œè¯·ä½¿ç”¨æ‰©å±•è¿›è¡Œæµ‹è¯•', 'success');
            } else {
                updateDebugInfo('âŒ æµ‹è¯•å…ƒç´ ä¸å­˜åœ¨');
                updateStatus('é¡µé¢å…ƒç´ å¼‚å¸¸', 'error');
            }
        }

        function testContentScript() {
            updateDebugInfo('æµ‹è¯•å†…å®¹è„šæœ¬åŠŸèƒ½...');

            try {
                // å‘é€æµ‹è¯•æ¶ˆæ¯åˆ°å†…å®¹è„šæœ¬
                window.postMessage({
                    type: 'DOM_WATCHER_MESSAGE',
                    message: { action: 'test', data: 'Hello from debug page' }
                }, '*');

                updateDebugInfo('âœ… æµ‹è¯•æ¶ˆæ¯å·²å‘é€');
                updateStatus('æµ‹è¯•æ¶ˆæ¯å·²å‘é€', 'success');
            } catch (error) {
                updateDebugInfo(`âŒ å‘é€æµ‹è¯•æ¶ˆæ¯å¤±è´¥: ${error.message}`);
                updateStatus('æµ‹è¯•å¤±è´¥', 'error');
            }
        }

        function testManually() {
            updateDebugInfo('å¼€å§‹æ‰‹åŠ¨æµ‹è¯•...');

            // æ¨¡æ‹Ÿå±æ€§å˜åŒ–
            const element = document.getElementById('testElement1');
            element.setAttribute('data-manual-test', 'manual-value-' + Date.now());

            updateDebugInfo('âœ… å·²è®¾ç½®data-manual-testå±æ€§');
            updateStatus('æ‰‹åŠ¨æµ‹è¯•å®Œæˆ', 'success');
        }

        function changeTestElement() {
            const element = document.getElementById('testElement1');
            const testValue = document.getElementById('testValue1');
            const newValue = 'changed-' + Date.now();

            element.setAttribute('data-test', newValue);
            testValue.textContent = newValue;

            updateDebugInfo(`âœ… data-testå±æ€§å·²æ”¹ä¸º: ${newValue}`);
        }

        function incrementCounter() {
            counter++;
            const element = document.getElementById('testElement1');
            const counterValue = document.getElementById('counterValue1');

            element.setAttribute('data-counter', counter);
            counterValue.textContent = counter;

            updateDebugInfo(`âœ… data-counterå±æ€§å·²æ”¹ä¸º: ${counter}`);
        }

        function resetTestElement() {
            counter = 0;
            const element = document.getElementById('testElement1');
            const testValue = document.getElementById('testValue1');
            const counterValue = document.getElementById('counterValue1');

            element.setAttribute('data-test', 'initial');
            element.setAttribute('data-counter', '0');
            testValue.textContent = 'initial';
            counterValue.textContent = '0';

            updateDebugInfo('âœ… æµ‹è¯•å…ƒç´ å·²é‡ç½®');
        }

        // ç›‘å¬æ¥è‡ªæ‰©å±•çš„æ¶ˆæ¯
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'DOM_WATCHER_RESPONSE') {
                updateDebugInfo(`ğŸ“¨ æ”¶åˆ°æ‰©å±•å“åº”: ${JSON.stringify(event.data.message)}`);
            }
        });

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = function() {
            updateDebugInfo('è°ƒè¯•æµ‹è¯•é¡µé¢å·²åŠ è½½');
            setTimeout(checkExtension, 1000);
        };
    </script>
</body>
</html>
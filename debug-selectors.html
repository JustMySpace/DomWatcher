<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSSé€‰æ‹©å™¨è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            line-height: 1.6;
        }
        .test-element {
            margin: 15px 0;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .test-element:hover {
            border-color: #007bff;
            box-shadow: 0 2px 8px rgba(0,123,255,0.2);
        }
        .test-element.selected {
            background-color: #e3f2fd;
            border-color: #2196f3;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-success {
            background: #28a745;
            color: white;
        }
        .btn-warning {
            background: #ffc107;
            color: black;
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        .debug-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            border-left: 4px solid #007bff;
        }
        #currentSelector {
            background: #fff3cd;
            border-left-color: #ffc107;
        }
    </style>
</head>
<body>
    <h1>ğŸ” CSSé€‰æ‹©å™¨è°ƒè¯•é¡µé¢</h1>

    <div class="debug-info" id="currentSelector">
        <strong>å½“å‰é€‰æ‹©å™¨:</strong> <span id="selectorDisplay">æœªé€‰æ‹©</span>
    </div>

    <div class="debug-info">
        <strong>æµ‹è¯•è¯´æ˜:</strong>
        <ol>
            <li>æ‰“å¼€æ‰©å±•ä¾§è¾¹æ </li>
            <li>ç‚¹å‡»"é€‰æ‹©å…ƒç´ "æŒ‰é’®</li>
            <li>ç‚¹å‡»ä¸‹é¢çš„ä»»æ„å…ƒç´ </li>
            <li>è§‚å¯Ÿè¿™é‡Œæ˜¾ç¤ºçš„CSSé€‰æ‹©å™¨</li>
            <li>åœ¨å¼€å‘è€…å·¥å…·ä¸­æµ‹è¯•é€‰æ‹©å™¨: <code>document.querySelector('é€‰æ‹©å™¨')</code></li>
        </ol>
    </div>

    <!-- ç®€å•çš„IDé€‰æ‹©å™¨æµ‹è¯• -->
    <div id="simple-test" class="test-element">
        <h3>ç®€å•IDæµ‹è¯•å…ƒç´ </h3>
        <p>è¿™ä¸ªå…ƒç´ æœ‰ID: <code>simple-test</code></p>
        <button onclick="changeAttribute('simple-test')" class="btn-primary">æ”¹å˜classå±æ€§</button>
    </div>

    <!-- å¸¦ç±»çš„å…ƒç´ æµ‹è¯• -->
    <div class="test-element container-item special">
        <h3>å¸¦å¤šä¸ªç±»çš„å…ƒç´ </h3>
        <p>ç±»å: <code>container-item special</code></p>
        <button onclick="changeDataAttribute(this.parentElement)" class="btn-success">æ”¹å˜dataå±æ€§</button>
    </div>

    <!-- åµŒå¥—å…ƒç´ æµ‹è¯• -->
    <div class="container">
        <div class="test-element nested">
            <h3>åµŒå¥—å…ƒç´ æµ‹è¯•</h3>
            <p>åœ¨.containerå†…çš„.test-element.nested</p>
            <button onclick="changeStyle(this.parentElement)" class="btn-warning">æ”¹å˜styleå±æ€§</button>
        </div>
    </div>

    <!-- æ— IDæ— ç±»å…ƒç´ æµ‹è¯• -->
    <div>
        <section>
            <article>
                <div class="test-element">
                    <h3>æ·±å±‚åµŒå¥—æ— IDå…ƒç´ </h3>
                    <p>åœ¨div > section > article > divç»“æ„ä¸­</p>
                    <button onclick="changeTitle(this.parentElement)" class="btn-danger">æ”¹å˜titleå±æ€§</button>
                </div>
            </article>
        </section>
    </div>

    <!-- ç›¸åŒç±»åå…ƒç´ æµ‹è¯• -->
    <div class="test-element duplicate">
        <h3>ç¬¬ä¸€ä¸ªé‡å¤å…ƒç´ </h3>
        <p>ç±»å: <code>duplicate</code> (ç¬¬ä¸€ä¸ª)</p>
        <button onclick="addCustomAttr(this.parentElement, 1)" class="btn-primary">æ·»åŠ è‡ªå®šä¹‰å±æ€§</button>
    </div>

    <div class="test-element duplicate">
        <h3>ç¬¬äºŒä¸ªé‡å¤å…ƒç´ </h3>
        <p>ç±»å: <code>duplicate</code> (ç¬¬äºŒä¸ª)</p>
        <button onclick="addCustomAttr(this.parentElement, 2)" class="btn-primary">æ·»åŠ è‡ªå®šä¹‰å±æ€§</button>
    </div>

    <div class="test-element duplicate">
        <h3>ç¬¬ä¸‰ä¸ªé‡å¤å…ƒç´ </h3>
        <p>ç±»å: <code>duplicate</code> (ç¬¬ä¸‰ä¸ª)</p>
        <button onclick="addCustomAttr(this.parentElement, 3)" class="btn-primary">æ·»åŠ è‡ªå®šä¹‰å±æ€§</button>
    </div>

    <script>
        // æ˜¾ç¤ºå½“å‰é€‰æ‹©çš„CSSé€‰æ‹©å™¨
        function updateSelectorDisplay(selector) {
            document.getElementById('selectorDisplay').textContent = selector || 'æœªé€‰æ‹©';
        }

        // æµ‹è¯•é€‰æ‹©å™¨æ˜¯å¦èƒ½æ‰¾åˆ°å…ƒç´ 
        function testSelector(selector) {
            if (!selector) return false;
            try {
                const element = document.querySelector(selector);
                console.log('æµ‹è¯•é€‰æ‹©å™¨:', selector, 'ç»“æœ:', element);
                return !!element;
            } catch (error) {
                console.error('é€‰æ‹©å™¨æµ‹è¯•å¤±è´¥:', selector, error);
                return false;
            }
        }

        // æ”¹å˜classå±æ€§
        function changeAttribute(elementId) {
            const element = document.getElementById(elementId);
            element.className = element.className === 'test-element'
                ? 'test-element modified'
                : 'test-element';
            console.log('classå·²æ”¹å˜ä¸º:', element.className);
        }

        // æ”¹å˜dataå±æ€§
        function changeDataAttribute(element) {
            const currentStatus = element.getAttribute('data-status') || 'inactive';
            const newStatus = currentStatus === 'inactive' ? 'active' : 'inactive';
            element.setAttribute('data-status', newStatus);
            console.log('data-statuså·²æ”¹å˜ä¸º:', newStatus);
        }

        // æ”¹å˜styleå±æ€§
        function changeStyle(element) {
            const colors = ['#f8f9fa', '#e3f2fd', '#fff3cd', '#d4edda', '#f8d7da'];
            const currentBg = element.style.backgroundColor;
            let nextColor = colors[0];
            for (let i = 0; i < colors.length; i++) {
                if (colors[i] === currentBg || colors[i].toLowerCase() === currentBg) {
                    nextColor = colors[(i + 1) % colors.length];
                    break;
                }
            }
            element.style.backgroundColor = nextColor;
            console.log('style.background-colorå·²æ”¹å˜ä¸º:', nextColor);
        }

        // æ”¹å˜titleå±æ€§
        function changeTitle(element) {
            const titles = ['é»˜è®¤æ ‡é¢˜', 'å·²ä¿®æ”¹çš„æ ‡é¢˜', 'å†æ¬¡ä¿®æ”¹çš„æ ‡é¢˜', 'æœ€ç»ˆæ ‡é¢˜'];
            const currentTitle = element.getAttribute('title') || 'é»˜è®¤æ ‡é¢˜';
            const currentIndex = titles.indexOf(currentTitle);
            const nextTitle = titles[(currentIndex + 1) % titles.length];
            element.setAttribute('title', nextTitle);
            console.log('titleå·²æ”¹å˜ä¸º:', nextTitle);
        }

        // æ·»åŠ è‡ªå®šä¹‰å±æ€§
        function addCustomAttr(element, index) {
            const value = `custom-value-${index}-${Date.now()}`;
            element.setAttribute('data-custom', value);
            console.log(`data-customå·²è®¾ç½®ä¸º: ${value}`);
        }

        // æ·»åŠ CSSæµ‹è¯•åŠŸèƒ½åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œä¾›è°ƒè¯•ä½¿ç”¨
        window.testSelector = testSelector;
        window.updateSelectorDisplay = updateSelectorDisplay;

        // ç›‘å¬æ¥è‡ªå†…å®¹è„šæœ¬çš„é€‰æ‹©å™¨æ›´æ–°
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'DOM_WATCHER_DEBUG') {
                if (event.data.selector) {
                    updateSelectorDisplay(event.data.selector);
                    const isValid = testSelector(event.data.selector);
                    document.getElementById('selectorDisplay').style.color = isValid ? 'green' : 'red';
                }
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        document.addEventListener('DOMContentLoaded', function() {
            console.log('CSSé€‰æ‹©å™¨è°ƒè¯•é¡µé¢å·²åŠ è½½');
            console.log('ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æµ‹è¯•é€‰æ‹©å™¨:');
            console.log('testSelector("é€‰æ‹©å™¨") - æµ‹è¯•é€‰æ‹©å™¨æ˜¯å¦æœ‰æ•ˆ');
            console.log('updateSelectorDisplay("é€‰æ‹©å™¨") - æ›´æ–°æ˜¾ç¤ºçš„é€‰æ‹©å™¨');
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOMå±æ€§ç›‘å¬å™¨ - ç®€å•æµ‹è¯•</title>
    <style>
        body {
            width: 350px;
            height: 400px;
            margin: 0;
            padding: 16px;
            font-family: Arial, sans-serif;
            font-size: 14px;
            background-color: #f5f5f5;
        }

        .header {
            text-align: center;
            margin-bottom: 16px;
        }

        button {
            padding: 10px 20px;
            margin: 5px 0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            width: 100%;
            background-color: #2196F3;
            color: white;
            box-sizing: border-box;
        }

        button:hover {
            background-color: #1976d2;
        }

        button:active {
            transform: translateY(1px);
        }

        .status {
            background: white;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
            box-sizing: border-box;
        }

        .log {
            background: white;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            max-height: 150px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            box-sizing: border-box;
        }

        .info {
            background: #e3f2fd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 12px;
            color: #1976d2;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <div class="header">
        <h2>ğŸ” DOMç›‘å¬å™¨</h2>
    </div>

    <div class="info" id="info">
        è°ƒè¯•ä¿¡æ¯åŠ è½½ä¸­...
    </div>

    <div class="status" id="status">
        ç­‰å¾…æµ‹è¯•...
    </div>

    <button id="testButton" onclick="testButtonClick()">ğŸ§ª æµ‹è¯•æŒ‰é’®ç‚¹å‡»</button>
    <button id="testAPI" onclick="testAPI()">ğŸ” æµ‹è¯•Chrome API</button>
    <button id="testSimple" onclick="testSimple()">âœ… ç®€å•æµ‹è¯•</button>
    <button id="testAlert" onclick="testAlert()">âš ï¸ æµ‹è¯•Alert</button>

    <div class="log" id="log">
        ç­‰å¾…æ—¥å¿—...
    </div>

    <script>
        // åŸºæœ¬æ—¥å¿—å‡½æ•°
        function addLog(text) {
            const log = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const newLog = `[${timestamp}] ${text}<br>` + log.innerHTML;
            log.innerHTML = newLog;
            console.log('Popupæ—¥å¿—:', text);
        }

        function updateStatus(text) {
            document.getElementById('status').textContent = text;
            console.log('çŠ¶æ€æ›´æ–°:', text);
        }

        function updateInfo(text) {
            document.getElementById('info').textContent = text;
            console.log('ä¿¡æ¯æ›´æ–°:', text);
        }

        // æµ‹è¯•å‡½æ•°
        function testButtonClick() {
            addLog('âœ… æµ‹è¯•æŒ‰é’®ç‚¹å‡»æˆåŠŸï¼');
            updateStatus('æŒ‰é’®ç‚¹å‡»æ­£å¸¸');
        }

        function testSimple() {
            addLog('âœ… ç®€å•æµ‹è¯•æˆåŠŸï¼');
            updateStatus('ç®€å•åŠŸèƒ½æ­£å¸¸');
        }

        function testAlert() {
            if (confirm('Alertæµ‹è¯•æ­£å¸¸å—ï¼Ÿ')) {
                addLog('âœ… Alertæµ‹è¯•æˆåŠŸï¼');
                updateStatus('Alertæ­£å¸¸');
            } else {
                addLog('âš ï¸ Alertæµ‹è¯•å–æ¶ˆ');
                updateStatus('Alertè¢«å–æ¶ˆ');
            }
        }

        function testAPI() {
            addLog('å¼€å§‹æµ‹è¯•Chrome API...');

            if (typeof chrome !== 'undefined' && chrome.runtime) {
                addLog('âœ… Chrome APIå¯ç”¨');

                try {
                    chrome.runtime.id && addLog(`âœ… æ‰©å±•ID: ${chrome.runtime.id.substring(0, 8)}...`);

                    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
                        if (chrome.runtime.lastError) {
                            addLog('âŒ tabs.queryé”™è¯¯: ' + chrome.runtime.lastError.message);
                        } else if (tabs && tabs[0]) {
                            addLog(`âœ… å½“å‰æ ‡ç­¾ID: ${tabs[0].id}`);
                            addLog(`âœ… å½“å‰URL: ${tabs[0].url.substring(0, 50)}...`);
                            updateStatus('Chrome APIæµ‹è¯•æˆåŠŸ');
                        } else {
                            addLog('âš ï¸ æ— æ³•è·å–æ ‡ç­¾ä¿¡æ¯');
                        }
                    });
                } catch (error) {
                    addLog('âŒ Chrome APIæµ‹è¯•å¤±è´¥: ' + error.message);
                }
            } else {
                addLog('âŒ Chrome APIä¸å¯ç”¨');
            }
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.addEventListener('load', function() {
            addLog('ğŸ‰ é¡µé¢åŠ è½½å®Œæˆï¼');
            updateInfo('é¡µé¢åŠ è½½æ­£å¸¸ï¼ŒJavaScriptå·¥ä½œæ­£å¸¸');
            updateStatus('å‡†å¤‡æµ‹è¯•');
        });

        // DOMå†…å®¹åŠ è½½å®Œæˆæ—¶çš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ğŸ“‹ DOMå†…å®¹åŠ è½½å®Œæˆï¼');
        });

        // ç«‹å³æ‰§è¡Œçš„æµ‹è¯•
        (function() {
            addLog('ğŸš€ è„šæœ¬å¼€å§‹æ‰§è¡Œï¼');
            updateInfo('è„šæœ¬æ­£åœ¨æ‰§è¡Œä¸­...');
        })();
    </script>
</body>
</html>